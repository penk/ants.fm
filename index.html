<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Ant Farm</title>
    <link rel="apple-touch-icon" href="logo.png" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black">

  </head>

  <body style="background: black; color: lightgray; width: 100%; height: 100%; margin: 0px;" onload="setup()">
  <canvas id="ctx"></canvas>
  </body>
<script>
document.ontouchmove = function(e){ 
    e.preventDefault(); 
}

var canvas = document.getElementsByTagName('canvas')[0];
var ctx = canvas.getContext("2d");

var sceneImage = new Image();
sceneImage.src = 'colony.png';
var antSprite = new Image();
antSprite.src = 'ant-sprite.png';

var ants = new Array();

function Ant(x, y) {
    this.x = x 
    this.y = y
    this.size = 32
    this.direction = 0
}

var tick = 0;
var map = new Array();

function setup() {

    // setup game scene 
    ctx.canvas.width  = 640;
    ctx.canvas.height = 1096;
    ctx.imageSmoothingEnabled = false;
    ctx.webkitImageSmoothingEnabled = false;
    ctx.drawImage(sceneImage, 0, 0, 80, 136, 0, 0, 640, 1096)

    // get game map here

    // create ants 
    ants.push(new Ant(300, 160));
    //ants.push(new Ant(100, 160));
    //ants.push(new Ant(350, 160));
}

function render() {
    ctx.clearRect(0, 0, 640, 1096);
    ctx.drawImage(sceneImage, 0, 0, 80, 136, 0, 0, 640, 1096);
}

var internalTick = 0;
function drawAnts() {
    for (var i = 0; i < ants.length; i++) {

        // Ants AI goes here 

        ants[i].x--;
        if (ants[i].x < 0) {
            (ants[i].direction == 1) ? ants[i].direction = 0 : ants[i].direction = 1
            ants[i].x = 640 - 48
        }

        //var nextStep = ctx.getImageData(ants[i].x, ants[i].y, 1, 1);
        // border: nextStep.data[0] == 0 

        //var direction = Math.floor(Math.random()*1);
        switch (ants[i].direction) {
            case 0:
                ctx.drawImage(antSprite, 0, 32*(internalTick%4), ants[i].size, ants[i].size, ants[i].x, ants[i].y, 48, 48);
                break;
            case 1:
                ctx.save();
                ctx.translate(640, 0)
                ctx.scale(-1, 1)
                ctx.drawImage(antSprite, 0, 32*(internalTick%4), ants[i].size, ants[i].size, ants[i].x, ants[i].y, 48, 48);
                ctx.restore();
                break;
        }
    }
    if (tick % 5 == 0) {
        internalTick++;
        if (internalTick>10)
            internalTick = internalTick%10
    }
}

(function gameLoop(){ 
    requestAnimationFrame(gameLoop); 
    render(); 
    drawAnts(); 
    tick++;
    if (tick>10)
        tick=tick%10
})();
</script>
</html>
